<script>
    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyDr9nA44Kkej*****GUzbMDECI8cTFI",
        authDomain: "dairy-farm-record-system.firebaseapp.com",
        projectId: "dairy-farm-record-system",
        storageBucket: "dairy-farm-record-system.appspot.com",
        messagingSenderId: "422124188212",
        appId: "1:422124188212:web:1bd31bee8d6e91e301d061"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const storage = firebase.storage();

    // Correct jsPDF reference
    const jsPDF = window.jspdf.jsPDF;

    async function generatePDF() {
        const form = document.getElementById('hygiene-checklist-form');
        let formData = new FormData(form);
        const dairyNumber = formData.get('dairy-number');

        let pdf = new jsPDF('p', 'pt', 'a4');

        // Add the logo to the PDF
        const imagePath = 'Picture2.png'; // Update this path if needed to match your project structure

        // Load the image and add to the PDF
        const img = new Image();
        img.src = imagePath;
        
        img.onload = function () {
            pdf.addImage(img, 'PNG', 40, 10, 100, 50);

            // Add form details to the PDF
            pdf.setFontSize(22);
            pdf.setTextColor('#002B5C');
            pdf.text('Dairy Shed Hygiene Checklist', 40, 80);

            pdf.setFontSize(12);
            pdf.setTextColor('#000000');
            pdf.setFont('helvetica', 'bold');
            pdf.text('Farm Details:', 40, 110);

            pdf.setFont('helvetica', 'normal');
            pdf.text(`Dairy Company: ${formData.get('dairy-company')}`, 40, 130);
            pdf.text(`Dairy Number: ${formData.get('dairy-number')}`, 40, 145);
            pdf.text(`Address: ${formData.get('address')}`, 40, 160);
            pdf.text(`Customer Name: ${formData.get('customer-name')}`, 40, 175);
            pdf.text(`Region: ${formData.get('region')}`, 40, 190);
            pdf.text(`Farm Name: ${formData.get('farm-name')}`, 40, 205);
            pdf.text(`Island: ${formData.get('island')}`, 40, 220);
            pdf.text(`Visit Date: ${formData.get('visit-date')}`, 40, 235);
            pdf.text(`Visit Type: ${formData.get('visit-type')}`, 40, 250);
            pdf.text(`Inspection Start Time: ${formData.get('inspection-start-time')}`, 40, 265);
            pdf.text(`Inspection End Time: ${formData.get('inspection-end-time')}`, 40, 280);
            pdf.text(`Inspection Completed By: ${formData.get('inspection-completed-by')}`, 40, 295);
            pdf.text(`Call Type: ${formData.get('call-type')}`, 40, 310);

            // Add checklist items table
            const checklistItemsDiv = document.getElementById('checklist-items').children;
            const checklistTable = [];

            for (let item of checklistItemsDiv) {
                const itemName = item.querySelector('label').textContent;
                const status = item.querySelector('select').value;
                const comments = item.querySelector('input[type="text"]').value;

                checklistTable.push([itemName, status, comments]);
            }

            pdf.autoTable({
                startY: 330,
                head: [['Item', 'Status', 'Comments']],
                body: checklistTable,
                styles: {
                    fontSize: 10,
                    cellPadding: 5,
                },
                headStyles: {
                    fillColor: '#002B5C',
                    textColor: '#FFFFFF'
                }
            });

            // Save the PDF locally
            pdf.save('Dairy_Shed_Hygiene_Checklist.pdf');
        };

        img.onerror = function () {
            console.error('Error loading the image from the specified path.');
        };
    }
</script>
